<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Your Grandma is Funky</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400;1,500;1,600;1,700&display=swap"
    rel="stylesheet">
  <link href="base.css" rel="stylesheet">
  <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
  <!-- Include Alpine.js from CDN -->
  <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>

  <!-- Alpine store for artist selection -->
  <script>
    document.addEventListener("alpine:init", () => {
      Alpine.store('artistSelection', {
        selectedArtist1: null,
        selectedArtist2: null,
        setArtist(artist) {
          if (!this.selectedArtist1 || this.selectedArtist1 === artist.name) {
            this.selectedArtist1 = artist.name;
          } else if (!this.selectedArtist2 || this.selectedArtist2 === artist.name) {
            this.selectedArtist2 = artist.name;
          } else {
            this.selectedArtist1 = artist.name;
            this.selectedArtist2 = null;
          }
        }
      });
    });
  </script>

  <!-- Fetch artists data from local artists.json -->
  <script>
    fetch('artists.json')
      .then(response => response.json())
      .then(data => {
        window.artists = data;
        console.log("Loaded artists data:", window.artists);
      })
      .catch(error => console.error("Error loading artists data:", error));
  </script>

  <!-- Gallery component definition in Alpine.js -->
  <script>
    function galleryComponent() {
      return {
        artists: [],
        init() {
          if (window.artists) {
            this.artists = window.artists;
          } else {
            const interval = setInterval(() => {
              if (window.artists) {
                this.artists = window.artists;
                clearInterval(interval);
              }
            }, 100);
          }
        },
        selectArtist(artist) {
          this.$store.artistSelection.setArtist(artist);
        }
      }
    }
  </script>

  <!-- Custom CSS for the Scrollbar -->
  <style>
    /* Hide scrollbar track */
    .gallery-container::-webkit-scrollbar {
      width: 8px;
      height: 8px;
      background: transparent;
      /* Hide track */
    }

    /* Custom scrollbar thumb */
    .gallery-container::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 4px;
      transition: background 0.3s ease-in-out;
    }

    /* Show scrollbar only when hovering */
    .gallery-container:hover::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.8);
    }

    /* Firefox scrollbar */
    .gallery-container {
      scrollbar-width: thin;
      scrollbar-color: transparent transparent;
    }

    .gallery-container:hover {
      scrollbar-color: rgba(255, 255, 255, 0.8) transparent;
    }

    /* Smooth scrolling */
    .gallery-container {
      scroll-behavior: smooth;
    }
  </style>
</head>

<body class="h-100dvh place-content-center">
  <nav class="fixed top-0 text-white text-3xl px-5 py-3 border-b w-full">
    Your Grandma Is Funky.
  </nav>

  <!-- GALLERY COMPONENT -->
  <div class="px-8 pt-16">
    <div x-data="galleryComponent()" class="gallery-container relative w-full mx-auto my-8 overflow-x-auto"
      x-init="init()">

      <div class="flex gap-8">
        <template x-for="artist in artists" :key="artist.name">
          <div class="bg-white p-4 border hover:bg-gray-100 cursor-pointer min-w-[240px] mb-8"
            @click="selectArtist(artist)">
            <img :src="artist.imageUrl" :alt="artist.name" class="w-full h-auto rounded-lg">

            <h3 class="font-bold" x-text="artist.name"></h3>
            <p class="text-sm" x-text="artist.roles.join(', ')"></p>
          </div>
        </template>
      </div>
    </div>
  </div>

  <!-- The form overlay, now managed by Alpine.js -->
  <div class="form-container m-8 max-w-[460px] place-self-center bg-white p-8" x-data="{ artists: [] }"
    x-init="artists = window.artists; console.log('Artists loaded:', artists)">
    <form class="flex flex-col gap-4">
      <h2 class="text-2xl text-black-500">The Connections: Life Is Music.</h2>
      <p>Choose two artists to see how their stories intertwined.</p>
      <label for="name1" class="hidden">Artist 1:</label>
      <select id="name1" name="name1" x-model="$store.artistSelection.selectedArtist1" class="border p-3 pe-12">
        <template x-for="artist in artists" :key="artist.name">
          <option x-text="artist.name" :value="artist.name"></option>
        </template>
      </select>
      <label for="name2" class="hidden">Artist 2:</label>
      <select id="name2" name="name2" x-model="$store.artistSelection.selectedArtist2" class="border p-3">
        <template x-for="artist in artists" :key="artist.name">
          <option x-text="artist.name" :value="artist.name"></option>
        </template>
      </select>
      <button type="submit" class="bg-black text-white text-xl font-bold p-3">Submit</button>
    </form>
  </div>

  <!-- Include Three.js from a CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="waves.js" type="text/javascript"></script>
</body>

</html>